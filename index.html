<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Faisal Sayyed">

<title>Mini-Project #01</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="MP #01_files/libs/clipboard/clipboard.min.js"></script>
<script src="MP #01_files/libs/quarto-html/quarto.js"></script>
<script src="MP #01_files/libs/quarto-html/popper.min.js"></script>
<script src="MP #01_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="MP #01_files/libs/quarto-html/anchor.min.js"></script>
<link href="MP #01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MP #01_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="MP #01_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="MP #01_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="MP #01_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini-Project #01</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Faisal Sayyed </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The NYC Payroll Analysis project aims to analyze payroll data from New York City’s public sector employees. The dataset, obtained from an open government source, contains detailed information about employee salaries, overtime pay, and other compensation elements. This project uses <strong>Quarto</strong>, an open-source scientific and technical publishing system, to create a well-structured, reproducible analysis report.</p>
<p>The primary objectives of this analysis are:</p>
<ol type="1">
<li><p><strong>Data Collection and Cleaning</strong> – Ensuring that data is structured correctly and free of inconsistencies.</p></li>
<li><p><strong>Data Merging and Transformation</strong> – Combining multiple datasets, if needed, and restructuring them for efficient analysis.</p></li>
<li><p><strong>Descriptive Analysis</strong> – Summarizing the dataset to extract key insights such as salary distribution and agency-wise breakdowns.</p></li>
<li><p><strong>Data Visualization</strong> – Creating insightful visual representations of payroll trends using <code>ggplot2</code>.</p></li>
<li><p><strong>Report Formatting and Communication</strong> – Structuring the findings in a professional document for decision-makers and stakeholders.Data Ingestion &amp; Cleaning</p></li>
</ol>
</section>
<section id="data-ingestion-and-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-ingestion-and-cleaning"><strong>1. Data Ingestion and Cleaning</strong></h2>
<section id="downloading-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="downloading-the-dataset"><strong>1.1 Downloading the Dataset</strong></h3>
<p>The payroll data is retrieved from an NYC Open Data portal. Since downloading large datasets repeatedly can be inefficient, the script first checks whether the file is already available locally. If the file is missing, the script downloads it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the URL of the dataset</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>nyc_payroll_url <span class="ot">&lt;-</span> <span class="st">"https://data.cityofnewyork.us/api/views/k397-673e/rows.csv?accessType=DOWNLOAD"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the local file name</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>local_file <span class="ot">&lt;-</span> <span class="st">"NYC_Payroll_Data.csv"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if file exists, if not, download it</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(local_file)) {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(nyc_payroll_url, <span class="at">destfile =</span> local_file, <span class="at">method =</span> <span class="st">"curl"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the dataset</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>payroll_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(local_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="initial-data-exploration" class="level3">
<h3 class="anchored" data-anchor-id="initial-data-exploration"><strong>1.2 Initial Data Exploration</strong></h3>
<p>Once the dataset is loaded, it’s essential to perform an initial assessment to understand its structure, detect missing values, and check for any inconsistencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View first few rows of the dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(payroll_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 17
  `Fiscal Year` `Payroll Number` `Agency Name`          `Last Name` `First Name`
          &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;                  &lt;chr&gt;       &lt;chr&gt;       
1          2020               17 OFFICE OF EMERGENCY M… BEREZIN     MIKHAIL     
2          2020               17 OFFICE OF EMERGENCY M… GEAGER      VERONICA    
3          2020               17 OFFICE OF EMERGENCY M… RAMANI      SHRADDHA    
4          2020               17 OFFICE OF EMERGENCY M… ROTTA       JONATHAN    
5          2020               17 OFFICE OF EMERGENCY M… WILSON II   ROBERT      
6          2020               17 OFFICE OF EMERGENCY M… WASHINGTON  MORIAH      
# ℹ 12 more variables: `Mid Init` &lt;chr&gt;, `Agency Start Date` &lt;chr&gt;,
#   `Work Location Borough` &lt;chr&gt;, `Title Description` &lt;chr&gt;,
#   `Leave Status as of June 30` &lt;chr&gt;, `Base Salary` &lt;dbl&gt;, `Pay Basis` &lt;chr&gt;,
#   `Regular Hours` &lt;dbl&gt;, `Regular Gross Paid` &lt;dbl&gt;, `OT Hours` &lt;dbl&gt;,
#   `Total OT Paid` &lt;dbl&gt;, `Total Other Pay` &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check column names</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(payroll_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Fiscal Year"                "Payroll Number"            
 [3] "Agency Name"                "Last Name"                 
 [5] "First Name"                 "Mid Init"                  
 [7] "Agency Start Date"          "Work Location Borough"     
 [9] "Title Description"          "Leave Status as of June 30"
[11] "Base Salary"                "Pay Basis"                 
[13] "Regular Hours"              "Regular Gross Paid"        
[15] "OT Hours"                   "Total OT Paid"             
[17] "Total Other Pay"           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check missing values</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(payroll_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Fiscal Year             Payroll Number 
                         0                    1745440 
               Agency Name                  Last Name 
                         0                      13608 
                First Name                   Mid Init 
                     13673                    2560039 
         Agency Start Date      Work Location Borough 
                       140                     506234 
         Title Description Leave Status as of June 30 
                       164                          0 
               Base Salary                  Pay Basis 
                         0                          0 
             Regular Hours         Regular Gross Paid 
                         0                          0 
                  OT Hours              Total OT Paid 
                         0                          0 
           Total Other Pay 
                         0 </code></pre>
</div>
</div>
<p><strong>Explanation:</strong></p>
<ul>
<li><p><code>head(payroll_data)</code> displays the first few rows, allowing us to understand the structure.</p></li>
<li><p><code>colnames(payroll_data)</code> prints all column names, helping us identify relevant fields.</p></li>
<li><p><code>colSums(is.na(payroll_data))</code> checks for missing values in each column.</p></li>
</ul>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning"><strong>1.3 Data Cleaning</strong></h3>
<p>To ensure consistency, we clean the dataset by:</p>
<ul>
<li><p>Removing unwanted columns.</p></li>
<li><p>Handling missing or incorrect values.</p></li>
<li><p>Standardizing column names for better readability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(payroll_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [6,225,611 × 17] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ Fiscal Year               : num [1:6225611] 2020 2020 2020 2020 2020 2020 2020 2020 2020 2020 ...
 $ Payroll Number            : num [1:6225611] 17 17 17 17 17 17 17 17 17 17 ...
 $ Agency Name               : chr [1:6225611] "OFFICE OF EMERGENCY MANAGEMENT" "OFFICE OF EMERGENCY MANAGEMENT" "OFFICE OF EMERGENCY MANAGEMENT" "OFFICE OF EMERGENCY MANAGEMENT" ...
 $ Last Name                 : chr [1:6225611] "BEREZIN" "GEAGER" "RAMANI" "ROTTA" ...
 $ First Name                : chr [1:6225611] "MIKHAIL" "VERONICA" "SHRADDHA" "JONATHAN" ...
 $ Mid Init                  : chr [1:6225611] NA "M" NA "D" ...
 $ Agency Start Date         : chr [1:6225611] "08/10/2015" "09/12/2016" "02/22/2016" "09/16/2013" ...
 $ Work Location Borough     : chr [1:6225611] "BROOKLYN" "BROOKLYN" "BROOKLYN" "BROOKLYN" ...
 $ Title Description         : chr [1:6225611] "EMERGENCY PREPAREDNESS MANAGER" "EMERGENCY PREPAREDNESS MANAGER" "EMERGENCY PREPAREDNESS MANAGER" "EMERGENCY PREPAREDNESS MANAGER" ...
 $ Leave Status as of June 30: chr [1:6225611] "ACTIVE" "ACTIVE" "ACTIVE" "ACTIVE" ...
 $ Base Salary               : num [1:6225611] 86005 86005 86005 86005 86005 ...
 $ Pay Basis                 : chr [1:6225611] "per Annum" "per Annum" "per Annum" "per Annum" ...
 $ Regular Hours             : num [1:6225611] 1820 1820 1820 1820 1820 1820 1820 1820 1820 1820 ...
 $ Regular Gross Paid        : num [1:6225611] 84698 84698 84698 84698 84698 ...
 $ OT Hours                  : num [1:6225611] 0 0 0 0 0 ...
 $ Total OT Paid             : num [1:6225611] 0 0 0 0 0 ...
 $ Total Other Pay           : num [1:6225611] 0 0 0 0 0 ...
 - attr(*, "spec")=
  .. cols(
  ..   `Fiscal Year` = col_double(),
  ..   `Payroll Number` = col_double(),
  ..   `Agency Name` = col_character(),
  ..   `Last Name` = col_character(),
  ..   `First Name` = col_character(),
  ..   `Mid Init` = col_character(),
  ..   `Agency Start Date` = col_character(),
  ..   `Work Location Borough` = col_character(),
  ..   `Title Description` = col_character(),
  ..   `Leave Status as of June 30` = col_character(),
  ..   `Base Salary` = col_double(),
  ..   `Pay Basis` = col_character(),
  ..   `Regular Hours` = col_double(),
  ..   `Regular Gross Paid` = col_double(),
  ..   `OT Hours` = col_double(),
  ..   `Total OT Paid` = col_double(),
  ..   `Total Other Pay` = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>payroll_data <span class="ot">&lt;-</span> payroll_data <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">Title Description</span><span class="st">`</span>, <span class="st">`</span><span class="at">Base Salary</span><span class="st">`</span>, <span class="st">`</span><span class="at">Total OT Paid</span><span class="st">`</span>, <span class="st">`</span><span class="at">Regular Gross Paid</span><span class="st">`</span>, <span class="st">`</span><span class="at">Fiscal Year</span><span class="st">`</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>payroll_data <span class="ot">&lt;-</span> payroll_data <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency =</span> <span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">job_title =</span> <span class="st">`</span><span class="at">Title Description</span><span class="st">`</span>, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_salary =</span> <span class="st">`</span><span class="at">Base Salary</span><span class="st">`</span>, </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">overtime_pay =</span> <span class="st">`</span><span class="at">Total OT Paid</span><span class="st">`</span>, </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pay =</span> <span class="st">`</span><span class="at">Regular Gross Paid</span><span class="st">`</span>, </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pay_year =</span> <span class="st">`</span><span class="at">Fiscal Year</span><span class="st">`</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>payroll_data <span class="ot">&lt;-</span> payroll_data <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_pay) <span class="sc">&amp;</span> total_pay <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(payroll_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  agency                   job_title base_salary overtime_pay total_pay pay_year
  &lt;chr&gt;                    &lt;chr&gt;           &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 OFFICE OF EMERGENCY MAN… EMERGENC…       86005            0    84698.     2020
2 OFFICE OF EMERGENCY MAN… EMERGENC…       86005            0    84698.     2020
3 OFFICE OF EMERGENCY MAN… EMERGENC…       86005            0    84698.     2020
4 OFFICE OF EMERGENCY MAN… EMERGENC…       86005            0    84698.     2020
5 OFFICE OF EMERGENCY MAN… EMERGENC…       86005            0    84698.     2020
6 OFFICE OF EMERGENCY MAN… EMERGENC…       86005            0    87901.     2020</code></pre>
</div>
</div>
<p><strong>Explanation:</strong></p>
<ul>
<li><p>We retain only relevant columns like <code>Agency</code>, <code>Base Salary</code>, and <code>Total Pay</code>.</p></li>
<li><p>Column names are renamed for readability.</p></li>
<li><p>Rows with missing or zero total pay are removed.</p></li>
</ul>
</section>
</section>
<section id="data-combination-and-alignment" class="level2">
<h2 class="anchored" data-anchor-id="data-combination-and-alignment"><strong>2. Data Combination and Alignment</strong></h2>
<p>In cases where multiple datasets (e.g., payroll data from different years) need to be merged, we use <code>dplyr::left_join()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>previous_year_payroll <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Citywide_Payroll_Data__Fiscal_Year_.csv"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>payroll_data <span class="ot">&lt;-</span> payroll_data <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">"_"</span>, .)))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>previous_year_payroll <span class="ot">&lt;-</span> previous_year_payroll <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">"_"</span>, .)))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print updated column names</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(payroll_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "agency"       "job_title"    "base_salary"  "overtime_pay" "total_pay"   
[6] "pay_year"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(previous_year_payroll)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "fiscal_year"                "payroll_number"            
 [3] "agency_name"                "last_name"                 
 [5] "first_name"                 "mid_init"                  
 [7] "agency_start_date"          "work_location_borough"     
 [9] "title_description"          "leave_status_as_of_june_30"
[11] "base_salary"                "pay_basis"                 
[13] "regular_hours"              "regular_gross_paid"        
[15] "ot_hours"                   "total_ot_paid"             
[17] "total_other_pay"           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>previous_year_payroll <span class="ot">&lt;-</span> previous_year_payroll <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency =</span> agency_name, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">job_title =</span> title_description</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>common_cols <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(payroll_data), <span class="fu">names</span>(previous_year_payroll))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(common_cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "agency"      "job_title"   "base_salary"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>payroll_data <span class="ot">&lt;-</span> payroll_data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>previous_year_payroll <span class="ot">&lt;-</span> previous_year_payroll <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>previous_year_payroll <span class="ot">&lt;-</span> previous_year_payroll <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, job_title, base_salary) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), first), <span class="at">.groups =</span> <span class="st">"drop"</span>) </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>merged_payroll <span class="ot">&lt;-</span> <span class="fu">left_join</span>(payroll_data, previous_year_payroll, </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency"</span>, <span class="st">"job_title"</span>, <span class="st">"base_salary"</span>))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(merged_payroll)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 20
  agency       job_title base_salary overtime_pay total_pay pay_year fiscal_year
  &lt;chr&gt;        &lt;chr&gt;           &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
1 OFFICE OF E… EMERGENC…       86005           0     84698.     2020        2023
2 OFFICE OF E… EMERGENC…       86005           0     87901.     2020        2023
3 OFFICE OF E… EMERGENC…       94415           0     84313.     2020        2020
4 OFFICE OF E… EMERGENC…       86005           0     83977.     2020        2023
5 OFFICE OF E… EMERGENC…       86005           0     83877.     2020        2023
6 OFFICE OF E… EMERGENC…       67676       16573.    66648.     2020        2021
# ℹ 13 more variables: payroll_number &lt;dbl&gt;, last_name &lt;chr&gt;, first_name &lt;chr&gt;,
#   mid_init &lt;chr&gt;, agency_start_date &lt;chr&gt;, work_location_borough &lt;chr&gt;,
#   leave_status_as_of_june_30 &lt;chr&gt;, pay_basis &lt;chr&gt;, regular_hours &lt;dbl&gt;,
#   regular_gross_paid &lt;dbl&gt;, ot_hours &lt;dbl&gt;, total_ot_paid &lt;dbl&gt;,
#   total_other_pay &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This step ensures that we can track salary changes over time.</p>
</section>
<section id="descriptive-statistical-analysis" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-statistical-analysis"><strong>3. Descriptive Statistical Analysis</strong></h2>
<section id="summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="summary-statistics"><strong>3.1 Summary Statistics</strong></h3>
<p>We calculate key metrics like mean, median, and salary distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics for salaries</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(payroll_data<span class="sc">$</span>base_salary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
     0.0     33.2  45484.0  46051.3  79237.0 414799.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(payroll_data<span class="sc">$</span>total_pay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      0    9422   40521   46133   76279  684970 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group-wise analysis</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>payroll_summary <span class="ot">&lt;-</span> payroll_data <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_salary =</span> <span class="fu">mean</span>(base_salary, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_salary =</span> <span class="fu">median</span>(base_salary, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_salary =</span> <span class="fu">max</span>(base_salary, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_salary =</span> <span class="fu">min</span>(base_salary, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># View summary</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(payroll_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 170 × 5
   agency                         avg_salary median_salary max_salary min_salary
   &lt;chr&gt;                               &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 ADMIN FOR CHILDREN'S SVCS        65906.         60327       277605      11   
 2 ADMIN TRIALS AND HEARINGS        35970.            61.5     260042       9.41
 3 BOARD OF CORRECTION              95327.         80955       220843   44694   
 4 BOARD OF CORRECTIONS             73991.         59573       151865   42727   
 5 BOARD OF ELECTION                33209.         35919       265554      11.9 
 6 BOARD OF ELECTION POLL WORKERS       1.13           1          100       1   
 7 BOROUGH PRESIDENT-BRONX          77043.         70056       220000      14.2 
 8 BOROUGH PRESIDENT-BROOKLYN       73543.         69526.      259541      13.6 
 9 BOROUGH PRESIDENT-QUEENS         72084.         67088       179200      13.6 
10 BOROUGH PRESIDENT-STATEN IS      61393.         60346       179200       7.25
# ℹ 160 more rows</code></pre>
</div>
</div>
<p><strong>Explanation:</strong></p>
<ul>
<li><p><code>summary(payroll_data$base_salary)</code> provides general statistics on salaries.</p></li>
<li><p><code>group_by(agency) %&gt;% summarize()</code> computes agency-wise salary statistics.</p></li>
</ul>
</section>
<section id="salary-distribution" class="level3">
<h3 class="anchored" data-anchor-id="salary-distribution"><strong>3.2 Salary Distribution</strong></h3>
<p>To understand the spread of salaries, we compute percentiles and standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute salary percentiles</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(payroll_data<span class="sc">$</span>total_pay, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0%        10%        20%        30%        40%        50%        60% 
     0.010   1825.000   6011.184  14058.674  26781.548  40521.375  51811.014 
       70%        80%        90%       100% 
 67404.970  83755.138  98026.389 684970.170 </code></pre>
</div>
</div>
<p>This helps detect <strong>income disparities</strong>, identifying if a small group earns significantly more than others.</p>
</section>
</section>
<section id="data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization"><strong>4. Data Visualization</strong></h2>
<section id="salary-distribution-histogram" class="level3">
<h3 class="anchored" data-anchor-id="salary-distribution-histogram"><strong>4.1 Salary Distribution Histogram</strong></h3>
<p>We use <code>ggplot2</code> to visualize salary distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of salaries</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(payroll_data, <span class="fu">aes</span>(<span class="at">x =</span> total_pay)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Total Pay in NYC Payroll"</span>, <span class="at">x =</span> <span class="st">"Total Pay"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP--01_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Explanation:</strong></p>
<ul>
<li><p><code>geom_histogram()</code> plots a histogram to see how salaries are distributed.</p></li>
<li><p>Helps in identifying salary ranges and outliers.</p></li>
</ul>
</section>
<section id="boxplot-of-salaries-by-agency" class="level3">
<h3 class="anchored" data-anchor-id="boxplot-of-salaries-by-agency"><strong>4.2 Boxplot of Salaries by Agency</strong></h3>
<p>A boxplot compares salaries across agencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>top_10_agencies <span class="ot">&lt;-</span> payroll_summary <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_salary)) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_10_agencies, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(agency, avg_salary), <span class="at">y =</span> avg_salary)) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 Agencies by Average Salary"</span>, <span class="at">x =</span> <span class="st">"Agency"</span>, <span class="at">y =</span> <span class="st">"Average Salary"</span>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP--01_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion-recommendations" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-recommendations">Conclusion &amp; Recommendations</h2>
<ol type="1">
<li><strong>Salary Variability:</strong> There is a wide range of salaries across agencies.</li>
<li><strong>Outliers:</strong> Certain job titles have significantly higher salaries, suggesting further review.</li>
<li><strong>Budget Allocation:</strong> Agencies with higher salary averages should be analyzed for efficiency.</li>
</ol>
<p>The analysis of citywide payroll data highlights significant variations in average salaries across different agencies. By focusing on the top 10 agencies with the highest average salaries, we can identify departments that offer the most competitive compensation. The data suggests that agencies with specialized roles, technical expertise, or leadership positions tend to have higher pay scales. However, the large discrepancy in salaries may indicate disparities in budget allocations or workforce structures. Further analysis is needed to explore factors influencing salary distribution, such as experience, job responsibilities, and funding sources, to ensure fair compensation and efficient resource management.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
